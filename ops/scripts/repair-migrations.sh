#!/bin/bash

# Script para reparar hist√≥rico de migra√ß√µes do Supabase
# Execute: chmod +x ops/scripts/repair-migrations.sh && ./ops/scripts/repair-migrations.sh

echo "üîß Reparando hist√≥rico de migra√ß√µes do Supabase..."
echo ""

# Migra√ß√µes a marcar como reverted (n√£o existem localmente ou foram removidas)
REVERTED_MIGRATIONS=(
  "20250628141702"
  "20250628143220"
  "20250701005518"
  "20250702000957"
  "20250702120000"
  "20250703085826"
  "20250703120000"
  "20250705000000"
  "20250706001248"
  "20250707000000"
  "20250708000000"
  "20250713234019"
  "20250714004357"
  "20250714005701"
  "20250714005800"
  "20250715000000"
  "20250716000000"
  "20250717000000"
  "20250718000000"
  "20250719000000"
  "20250720000000"
  "20250721000000"
  "20250722000000"
  "20250723000000"
  "20250724000000"
  "20250725000000"
  "20250901161858"
  "20250901162047"
  "20250902085035"
  "20250902101334"
  "20250902101407"
  "20250902101522"
  "20250902101711"
  "20250903001029"
  "20250903001119"
  "20250903001728"
  "20250903001823"
  "20250904003652"
  "20250904003751"
  "20250904004025"
  "20250906095203"
  "20250906095220"
  "20250906095245"
  "20250906122044"
  "20250906130017"
  "20250906132809"
  "20250907094127"
  "20251005001602"
  "20251018000000"
  "20251105172232"
  "20251105182042"
  "20251110175538"
  "20251210213144"
  "20251214015822"
  "20251214015904"
  "20251214020940"
  "20251215174333"
  "20251227120000"
  "20251230000000"
  "20251230000001"
  "20251230000002"
  "20251230000003"
  "20251230000004"
  "20251230000005"
  "20251230000006"
  "20251231000000"
  "20251231000001"
  "20251231000002"
  "20251231000003"
  "20251231000004"
  "20251231000005"
  "20251231000006"
  "20251231000007"
  "20251231000008"
  "20251231000009"
  "20260111220651"
)

# Migra√ß√£o a marcar como applied
APPLIED_MIGRATION="20260111220652"

echo "üìã Marcando ${#REVERTED_MIGRATIONS[@]} migra√ß√µes como reverted..."
for migration in "${REVERTED_MIGRATIONS[@]}"; do
  echo "  ‚Ü©Ô∏è  $migration"
  npx supabase migration repair --status reverted "$migration"
done

echo ""
echo "‚úÖ Marcando migra√ß√£o $APPLIED_MIGRATION como applied..."
npx supabase migration repair --status applied "$APPLIED_MIGRATION"

echo ""
echo "üéâ Repara√ß√£o conclu√≠da! Execute 'npx supabase db pull' novamente."
